### 8.4.1.优化数据大小

设计你的表使它们在磁盘上占据的空间尽可能小。这通过减少从磁盘写和读取数据的数量能带来巨大的改进。在查询执行过程中小表的内容被处理时占用较少的内存。对于表数据的任何空间减小也能导致更小的索引，更小的索引能被处理得更快。

MySQL支持许多不同的存储引擎(表类型)和行格式。对于每个表，可以确定使用哪个存储引擎和索引方法。为应用程序选择合适的表格式可以大大提高性能。参见[第14章,存储引擎和表类型][14]。

可以使用下面的技术可以使表的性能更好并且使存储空间最小：

**表列**

* 尽可能地使用最有效(最小)的数据类型。MySQL有很多节省磁盘空间和内存的专业化类型。例如，尽可能使用较小的整数类型使表更小。**MEDIUMINT**经常比**INT**好一些，因为**MEDIUMINT**列使用的空间要少25%。 

* 如果可能，声明列为NOT NULL。它通过使更好地使用索引和消除了为测试每个值是否为**NULL**的开支来令到SQL操作更快。你也可以节省一些存储空间，每列可以节省一位。如果在应用程序中确实需要NULL，应该毫无疑问使用它，只是避免默认地在所有列为**NULL**。

**行格式**

* **InnoDB**表使用更紧凑的存储格式。在MySQL5.0.3以前的版本中，**InnoDB**记录包含一些冗余信息，例如列数目和每个列的长度，即使对于固定大小的列。默认情况，创建的表为紧凑格式(**ROW_FORMAT=COMPACT**)。如果想要降级旧版本的MySQL，可以用**ROW_FORMAT=REDUNDANT**要求旧的格式。

  紧凑行格式的出现以为一些操作增加20%的CPU使用为代价减少了行存储空间。如果你的工作量是一种典型的受限于缓存命中率和磁盘速度，那可能会更快。受限于CPU速度的极少数例子 ，它可能会更慢。

  紧凑的**InnoDB**格式也改变了包含UTF-8数据的**CHAR**列的保存方式。在**ROW_FORMAT=REDUNDANT**格式中，UTF-8 **CHAR(N)**占用3*N字节，假定UTF-8编码的字符的最大长度是3字节。许多语言可以主要用单字节UTF-8字符来编写，固定的存储长度通常会浪费空间。通过根据需要剥离尾部的空格，**ROW_FORMAT=COMPACT**格式为这些列分配可变数量的**N**..3*N字节。最小存储长度按顺序保存为**N**字节，以在典型情况下帮助更新。

* 通过以压缩形式存储表数据、创建**InnoDB**表时指定**ROW_FOTMAT=COMPRESSED**或者在一个存在的**MyISAM**表运行**myisampack**命令来变本加厉减少空间。（**InnoDB**表压缩表是可读和可写的，而**MyISAM**表只读。）

* 对于MyISAM表，如果没有任何变长列(**VARCHAR**、**TEXT**或**BLOB**列)，使用固定尺寸的记录格式。这比较快但是不幸地可能会浪费一些空间。参见[章节14.3.3，“MyISAM表的存储格式”][14.3.3]。即使你已经用**CREATE**选项让**VARCHAR**列**ROW_FORMAT=fixed**，也可以提示想使用固定长度的行。

**索引**

* 每张表的主索引应该尽可能短。这使一行的识别容易而有效。对于**InnoDB**表，主键列在第二索引条目重复，所以如果你有很多第二索引，一个短的主键能节省相当大的空间。

* 只创建你确实需要提高查询性能的索引。索引对检索有好处，但是会降低插入和更新操作。如果主要通过搜索列的组合来存取一个表，对它们做一个索引而不是单独为每个列索引。索引的第一个部分应该是最常用的列。如果从表中选择时总是使用许多列，第一列应该是最重要的一列，以获得更好的索引压缩。

* 如果很可能一个长字符串列在头几个字符上有唯一的前缀，仅仅索引该前缀比较好。MySQL支持对一个字符列的最左边部分创建一个索引(参见[章节13.1.13，“CREATE INDEX语法”][13.1.13])。更短的索引会更快，不仅因为它们占较少的磁盘空间，而且因为它们将在索引缓存中提供更多的访问，因此磁盘搜索更少。参见[章节8.11.2节，“调节服务器参数”][8.11.2]。 

**连接**

*  在一些情形下，将一个经常被扫描的表分割为2个表是有益的。特别是如果它是一个动态格式的表，并且可能使用一个扫描表时能用来找出相关行的较小静态格式的表。

* 在不同表中具有相同信息的列应该被声明为相同的数据类型，加速基于相关列的连接。

* 保持列名简单，这样你可以使用相同名字横跨不同的表和简化连接查询。例如，在customer表中使用name而不是customer_name。为了使名字能移植到其它SQL服务器，应该使名字短于18个字符。 

**标准化**

* 在一般情况下，尝试以非冗余方式(查看数据库理论中的第三正则形式)保存数据。而不是重复冗长的值例如名字和地址，分配他们唯一的IDs,当需要横跨多个小表时重复这些IDs，和在连接子句通过参照IDs来连接表。

* 如果速度比磁盘空间和维护数据多份复制的开支重要，例如在一个你需要从大表分析所有数据的商业智能场景，你可以放松标准化规则，复制信息或创建总结表。来获得更快的速度。 


[14]:./docs/14.00.00_Storage_Engines.md

[14.3.3]:./docs/14.03.03_MyISAM_Table_Storage_Formats.md

[13.1.13]:./docs/13.01.13_CREATE_INDEX_Syntax.md

[8.11.2]:./docs/08.11.02_Tuning_Server_Parameters.md